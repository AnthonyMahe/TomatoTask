# Flatpak Build Configuration

This directory contains the configuration files needed to build TomatoTask as a Flatpak package.

## Files

- `com.tomatotask.app.yml` - Main Flatpak manifest
- `com.tomatotask.app.metainfo.xml` - AppStream metadata for Flathub
- `generated-sources.json` - Auto-generated npm dependencies sources
- `cargo-sources.json` - Auto-generated Rust cargo dependencies sources

## Generating Source Files

The source files for offline building are automatically generated by the GitHub Actions workflow.
If you need to generate them manually on Linux:

### Prerequisites

```bash
# Install flatpak-builder
sudo apt install flatpak-builder

# Install flatpak generators
pip3 install --user flatpak-node-generator aiohttp toml
pip3 install --user flatpak-cargo-generator
```

### Generate Node.js sources

```bash
# From the project root
cd flatpak
flatpak-node-generator npm ../package-lock.json -o generated-sources.json
```

### Generate Cargo sources

```bash
# From the project root
cd flatpak
python3 -m flatpak_cargo_generator ../src-tauri/Cargo.lock -o cargo-sources.json
```

## Building Locally

```bash
# Install Flatpak runtime and SDK
flatpak install flathub org.freedesktop.Platform//23.08
flatpak install flathub org.freedesktop.Sdk//23.08
flatpak install flathub org.freedesktop.Sdk.Extension.rust-stable//23.08
flatpak install flathub org.freedesktop.Sdk.Extension.node20//23.08

# Build the Flatpak
flatpak-builder --force-clean build-dir com.tomatotask.app.yml

# Install locally
flatpak-builder --user --install --force-clean build-dir com.tomatotask.app.yml

# Run the application
flatpak run com.tomatotask.app
```

## Publishing to Flathub

1. Fork the [Flathub repository](https://github.com/flathub/flathub)
2. Create a new repository named `com.tomatotask.app`
3. Add the manifest files from this directory
4. Submit a pull request to Flathub
5. Follow the [Flathub submission guidelines](https://docs.flathub.org/docs/for-app-authors/submission/)

## GitHub Releases

The GitHub Actions workflow automatically builds and publishes Flatpak packages to GitHub Releases for each version tag.
